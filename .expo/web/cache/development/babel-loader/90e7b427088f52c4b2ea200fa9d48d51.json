{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/Users/steven/Desktop/CupOJavaScript/components/social/UserList.js\";\nimport React, { useState } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Modal from \"react-native-web/dist/exports/Modal\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Pressable from \"react-native-web/dist/exports/Pressable\";\nimport fire from \"../fire\";\nexport default function UserList() {\n  var _this = this;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      userList = _useState2[0],\n      setUserList = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      splitUserList = _useState4[0],\n      setSplitUserList = _useState4[1];\n\n  var usersDB = fire.firestore().collection('users');\n  var friendsDB = fire.firestore().collection('friendships');\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      userDataIsRetrieved = _useState6[0],\n      setUserDataIsRetrieved = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      popupOpen = _useState8[0],\n      setPopupOpen = _useState8[1];\n\n  var _useState9 = useState(null),\n      _useState10 = _slicedToArray(_useState9, 2),\n      popupItem = _useState10[0],\n      setPopupItem = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      isFriend = _useState12[0],\n      setIsFriend = _useState12[1];\n\n  var currentUserID = fire.auth().currentUser.uid;\n\n  var _useState13 = useState(5),\n      _useState14 = _slicedToArray(_useState13, 2),\n      startIndex = _useState14[0],\n      setStartIndex = _useState14[1];\n\n  var _useState15 = useState(10),\n      _useState16 = _slicedToArray(_useState15, 2),\n      endIndex = _useState16[0],\n      setEndIndex = _useState16[1];\n\n  var getUsers = function getUsers() {\n    usersDB.get().then(function (querySnapshot) {\n      var userData = querySnapshot.docs.map(function (doc) {\n        return doc.data();\n      });\n      setUserList(userData);\n      setSplitUserList(userData.slice(0, 5));\n    }).catch(function (error) {\n      console.log('Error getting documents: ', error);\n    });\n    setUserDataIsRetrieved(true);\n  };\n\n  var togglePopup = function togglePopup(item) {\n    setPopupOpen(!popupOpen);\n\n    if (item != null) {\n      setPopupItem(item);\n      checkFriends(item);\n    }\n  };\n\n  var continueList = function continueList(start, end) {\n    setSplitUserList(splitUserList.concat(userList.slice(start, end)));\n    setStartIndex(startIndex + 5);\n    setEndIndex(endIndex + 5);\n  };\n\n  if (userDataIsRetrieved == false) {\n    getUsers();\n  }\n\n  function checkFriends(user2) {\n    friendsDB.get().then(function (querySnapshot) {\n      var friendshipData = querySnapshot.docs.map(function (doc) {\n        return doc.data();\n      });\n\n      for (var i = 0; i < friendshipData.length; i++) {\n        if (friendshipData[i].user1 == currentUserID && friendshipData[i].user2 == user2.id || friendshipData[i].user2 == currentUserID && friendshipData[i].user1 == user2.id) {\n          setIsFriend(true);\n        }\n      }\n    }).catch(function (error) {\n      console.log('Error getting documents: ', error);\n    });\n  }\n\n  function sendFriendRequest(user2) {\n    usersDB.doc(user2.id).collection(\"friendRequests\").get().then(function (querySnapshot) {\n      var friendRequests = querySnapshot.docs.map(function (doc) {\n        return doc.data();\n      });\n      var hasPendingRequest = false;\n\n      for (var i = 0; i < friendRequests.length; i++) {\n        if (friendRequests[i].userID == currentUserID) {\n          hasPendingRequest = true;\n        }\n      }\n\n      if (hasPendingRequest) {\n        alert(\"Friend request already pending.\");\n      } else {\n        usersDB.doc(user2.id).collection(\"friendRequests\").add({\n          userID: currentUserID\n        });\n        alert(\"Friend request sent!\");\n        checkForAcceptFriendRequest(user2.id);\n      }\n    }).catch(function (error) {\n      console.log('Error getting documents: ', error);\n    });\n  }\n\n  function checkForAcceptFriendRequest(user2ID) {\n    usersDB.doc(currentUserID).collection(\"friendRequests\").get().then(function (querySnapshot) {\n      var friendRequests = querySnapshot.docs.map(function (doc) {\n        return doc.data();\n      });\n      var hasPendingRequest = false;\n\n      for (var i = 0; i < friendRequests.length; i++) {\n        if (friendRequests[i].userID == user2ID) {\n          hasPendingRequest = true;\n        }\n      }\n\n      if (hasPendingRequest) {\n        acceptFriendRequest(user2ID);\n      }\n    }).catch(function (error) {\n      console.log('Error getting documents: ', error);\n    });\n  }\n\n  function acceptFriendRequest(user2ID) {\n    friendsDB.get().then(function (querySnapshot) {\n      var friendshipData = querySnapshot.docs.map(function (doc) {\n        return doc.data();\n      });\n      var friendshipExists = false;\n\n      for (var i = 0; i < friendshipData.length; i++) {\n        if (friendshipData[i].user1 == currentUserID && friendshipData[i].user2 == user2ID || friendshipData[i].user2 == currentUserID && friendshipData[i].user1 == user2ID) {\n          friendshipExists = true;\n        }\n      }\n\n      if (!friendshipExists) {\n        friendsDB.add({\n          user1: user2ID,\n          user2: currentUserID\n        });\n      }\n    }).catch(function (error) {\n      console.log('Error getting documents: ', error);\n    });\n  }\n\n  return React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }\n  }, React.createElement(FlatList, {\n    data: splitUserList,\n    renderItem: function renderItem(_ref) {\n      var item = _ref.item;\n      return React.createElement(View, {\n        style: styles.profileData,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 17\n        }\n      }, React.createElement(TouchableOpacity, {\n        onPress: function onPress() {\n          return togglePopup(item);\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 21\n        }\n      }, React.createElement(Image, {\n        source: {\n          uri: item.profilePicId\n        },\n        style: styles.profilePicture,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 25\n        }\n      }), React.createElement(View, {\n        style: {\n          alignItems: 'center'\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 25\n        }\n      }, React.createElement(Text, {\n        style: styles.name,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 29\n        }\n      }, item.first_name + \" \" + item.last_name), React.createElement(Text, {\n        style: styles.purposeText,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 29\n        }\n      }, \"I want to \", item.purpose, \" weight!\", '\\n'))));\n    },\n    onEndReached: function onEndReached() {\n      return continueList(startIndex, endIndex);\n    },\n    onEndReachedThreshold: 1,\n    keyExtractor: function keyExtractor(item, index) {\n      return index.toString();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 13\n    }\n  }), popupItem != null && React.createElement(Modal, {\n    animationType: \"none\",\n    visible: popupOpen,\n    transparent: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }\n  }, React.createElement(View, {\n    style: styles.center,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 17\n    }\n  }, React.createElement(View, {\n    style: styles.modalBody,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 21\n    }\n  }, React.createElement(TouchableOpacity, {\n    onPress: function onPress() {\n      togglePopup(null);\n      setIsFriend(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 25\n    }\n  }, React.createElement(Text, {\n    style: styles.xbutton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 29\n    }\n  }, \"X\"))))));\n}\nvar styles = {\n  name: {\n    fontSize: 23,\n    fontFamily: 'NunitoSans-Bold',\n    marginLeft: 10\n  },\n  purposeText: {\n    fontFamily: 'NunitoSans-Regular',\n    fontSize: 18,\n    marginLeft: 10\n  },\n  profilePicture: {\n    marginLeft: 10,\n    marginTop: 10,\n    width: 180,\n    height: 180,\n    borderRadius: 100\n  },\n  profileData: {\n    borderWidth: 0.25,\n    borderColor: \"#D3D3D3\",\n    alignItems: 'center'\n  },\n  center: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    marginTop: 20\n  },\n  modalBody: {\n    backgroundColor: '#F8F8FF',\n    borderRadius: 10,\n    width: '100%',\n    height: '40%',\n    alignItems: \"center\",\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 20,\n      height: 3\n    },\n    shadowOpacity: 0.5,\n    shadowRadius: 4,\n    elevation: 40\n  },\n  xbutton: {\n    marginTop: 10,\n    marginLeft: 290,\n    fontSize: 30,\n    opacity: 0.3\n  }\n};","map":{"version":3,"sources":["/Users/steven/Desktop/CupOJavaScript/components/social/UserList.js"],"names":["React","useState","fire","UserList","userList","setUserList","splitUserList","setSplitUserList","usersDB","firestore","collection","friendsDB","userDataIsRetrieved","setUserDataIsRetrieved","popupOpen","setPopupOpen","popupItem","setPopupItem","isFriend","setIsFriend","currentUserID","auth","currentUser","uid","startIndex","setStartIndex","endIndex","setEndIndex","getUsers","get","then","querySnapshot","userData","docs","map","doc","data","slice","catch","error","console","log","togglePopup","item","checkFriends","continueList","start","end","concat","user2","friendshipData","i","length","user1","id","sendFriendRequest","friendRequests","hasPendingRequest","userID","alert","add","checkForAcceptFriendRequest","user2ID","acceptFriendRequest","friendshipExists","styles","profileData","uri","profilePicId","profilePicture","alignItems","name","first_name","last_name","purposeText","purpose","index","toString","center","modalBody","xbutton","fontSize","fontFamily","marginLeft","marginTop","width","height","borderRadius","borderWidth","borderColor","flex","justifyContent","backgroundColor","shadowColor","shadowOffset","shadowOpacity","shadowRadius","elevation","opacity"],"mappings":"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","sourcesContent":["import React, {useState} from 'react'\nimport { Text, View, FlatList, Image, Modal, TouchableOpacity, Pressable } from 'react-native'\nimport fire from '../fire'\n\nexport default function UserList() {\n    const [userList, setUserList] = useState(null);\n    const [splitUserList, setSplitUserList] = useState(null);\n    const usersDB = fire.firestore().collection('users');\n    const friendsDB = fire.firestore().collection('friendships');\n    const [userDataIsRetrieved, setUserDataIsRetrieved] = useState(false);\n    \n    const [popupOpen, setPopupOpen] = useState(false);\n    const [popupItem, setPopupItem] = useState(null);\n\n    const [isFriend, setIsFriend] = useState(false);\n    const currentUserID = fire.auth().currentUser.uid;\n\n    const [startIndex, setStartIndex] = useState(5);\n    const [endIndex, setEndIndex] = useState(10);\n\n    //Get user information from firestore\n    const getUsers = () => {\n        usersDB.get().then(function(querySnapshot) {\n            let userData = querySnapshot.docs.map(doc => doc.data())\n            setUserList(userData)\n            setSplitUserList(userData.slice(0, 5))\n        }).catch(function(error) {console.log('Error getting documents: ', error)})\n\n        setUserDataIsRetrieved(true);\n    }\n\n    const togglePopup = (item) => {\n        setPopupOpen(!popupOpen)\n\n        if (item != null) {\n            setPopupItem(item);\n\n            checkFriends(item)\n        }\n    }\n\n    const continueList = (start, end) => {\n        setSplitUserList(splitUserList.concat(userList.slice(start, end)));\n        setStartIndex(startIndex + 5);\n        setEndIndex(endIndex + 5);\n    }\n\n    if (userDataIsRetrieved == false) {\n        getUsers();\n    }\n\n    function checkFriends(user2) {\n        friendsDB.get().then(function(querySnapshot) {\n            let friendshipData = querySnapshot.docs.map(doc => doc.data());\n\n            for (let i = 0; i < friendshipData.length; i++) {\n                if ((friendshipData[i].user1 == currentUserID && friendshipData[i].user2 == user2.id) || \n                (friendshipData[i].user2 == currentUserID && friendshipData[i].user1 == user2.id)) {\n                    setIsFriend(true);\n                }\n            }\n        }).catch(function(error) {console.log('Error getting documents: ', error)})\n    }\n\n    function sendFriendRequest(user2) {\n        usersDB.doc(user2.id).collection(\"friendRequests\").get().then(function(querySnapshot) {\n            let friendRequests = querySnapshot.docs.map(doc => doc.data());\n            let hasPendingRequest = false;\n\n            for (let i = 0; i < friendRequests.length; i++) {\n                if (friendRequests[i].userID == currentUserID) {\n                    hasPendingRequest = true;\n                }\n            }\n\n            if (hasPendingRequest) {\n                alert(\"Friend request already pending.\");\n            }\n            else {\n                usersDB.doc(user2.id).collection(\"friendRequests\").add({userID: currentUserID});\n                alert(\"Friend request sent!\");\n                checkForAcceptFriendRequest(user2.id);\n            }\n\n        }).catch(function(error) {console.log('Error getting documents: ', error)})\n    }\n\n    function checkForAcceptFriendRequest(user2ID) {\n        usersDB.doc(currentUserID).collection(\"friendRequests\").get().then(function(querySnapshot) {\n            let friendRequests = querySnapshot.docs.map(doc => doc.data());\n            let hasPendingRequest = false;\n\n            for (let i = 0; i < friendRequests.length; i++) {\n                if (friendRequests[i].userID == user2ID) {\n                    hasPendingRequest = true;\n                }\n            }\n\n            if (hasPendingRequest) {\n                acceptFriendRequest(user2ID);\n            }\n\n        }).catch(function(error) {console.log('Error getting documents: ', error)})\n    }\n\n    function acceptFriendRequest(user2ID) {\n        friendsDB.get().then(function(querySnapshot) {\n            let friendshipData = querySnapshot.docs.map(doc => doc.data());\n            let friendshipExists = false;\n\n            for (let i = 0; i < friendshipData.length; i++) {\n                if ((friendshipData[i].user1 == currentUserID && friendshipData[i].user2 == user2ID) || \n                (friendshipData[i].user2 == currentUserID && friendshipData[i].user1 == user2ID)) {\n                    friendshipExists = true;\n                }\n            }\n\n            if (!friendshipExists) {\n                friendsDB.add({user1: user2ID, user2: currentUserID})\n            }\n        }).catch(function(error) {console.log('Error getting documents: ', error)})\n    }\n\n\n    return (\n        <View>\n            <FlatList\n            data={splitUserList}\n            renderItem={({item}) => \n                <View style = {styles.profileData}>\n                    <TouchableOpacity onPress = {() => togglePopup(item)}>\n                        <Image source={{uri: item.profilePicId}} style={styles.profilePicture}/>\n                        <View style={{ alignItems: 'center'}}>\n                            <Text style= {styles.name}>{item.first_name + \" \" + item.last_name}</Text>\n                            <Text style = {styles.purposeText}>I want to {item.purpose} weight!{'\\n'}</Text>\n                        </View>\n                    </TouchableOpacity>\n                </View>}\n            onEndReached = {() => continueList(startIndex, endIndex)}\n            onEndReachedThreshold = {1}\n            keyExtractor = {(item, index) => index.toString()}\n        />\n        {popupItem != null && \n            <Modal animationType='none' visible={popupOpen} transparent={true}>\n                <View style={styles.center}>\n                    <View style={styles.modalBody}>\n                        <TouchableOpacity onPress={() => {togglePopup(null); setIsFriend(false);}}>\n                            <Text style={styles.xbutton}>X</Text>\n                        </TouchableOpacity>\n                    </View>\n                </View>\n            </Modal>\n        }\n        </View>\n        \n\n        //         {popupItem != null &&\n        //         <Modal animationType = 'none' visible = {popupOpen} transparent = {true}>\n        //             <View style = {styles.center}>\n        //                 <View style = {styles.modalBody}>\n        //                     <TouchableOpacity onPress = {() => {togglePopup(null); setIsFriend(false);}}>\n        //                         <Text style = {styles.xbutton}>X</Text>\n        //                     </TouchableOpacity>\n        //                     <Text>{popupItem.first_name}</Text>\n        //                     <Text>{popupItem.sex}</Text>\n        //                     <Text>{popupItem.feet}' {popupItem.inches}\"</Text>\n        //                     <Text>{popupItem.weight}lbs</Text>\n        //                     <Text>{popupItem.bmi}</Text>\n\n\n        //                     {isFriend == false && popupItem.id != currentUserID &&\n        //                         <TouchableOpacity onPress = {() => sendFriendRequest(popupItem)}>\n        //                             <Text>Send Friend Request</Text>\n        //                         </TouchableOpacity>\n        //                     }\n        //                     {isFriend == true &&\n        //                         <Text>You are friends!</Text>\n        //                     }\n        //                 </View>\n        //             </View>\n        //         </Modal>}\n  )\n}\n\nconst styles = {\n    name: {\n        fontSize: 23,\n        fontFamily: 'NunitoSans-Bold',\n        marginLeft: 10\n    },\n    purposeText: {\n        fontFamily: 'NunitoSans-Regular',\n        fontSize: 18,\n        marginLeft: 10\n    },\n    profilePicture: {\n        marginLeft: 10,\n        marginTop: 10,\n        width: 180,\n        height: 180,\n        borderRadius: 100,\n    },\n    profileData: {\n        borderWidth: 0.25,\n        borderColor: \"#D3D3D3\",\n        alignItems: 'center'\n    },\n    center: {\n        flex: 1,\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        marginTop: 20\n    },\n    modalBody: {\n        backgroundColor: '#F8F8FF',\n        borderRadius: 10,\n        width: '100%',\n        height: '40%',\n        alignItems: \"center\",\n        shadowColor: \"#000\",\n        shadowOffset: \n        {\n          width: 20,\n          height: 3\n        },\n        shadowOpacity: 0.5,\n        shadowRadius: 4,\n        elevation: 40\n    },\n    xbutton: {\n        marginTop: 10,\n        marginLeft: 290,\n        fontSize: 30,\n        opacity: 0.3\n    }\n}"]},"metadata":{},"sourceType":"module"}